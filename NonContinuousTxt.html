<!DOCTYPE html>
<html>

<head>
<style>
.mark {background-color: yellow;}

</style>
</head>

<body >

<p>First select the data and then press alt</p>
<h4> Dummy data</h4>
<p id="content" onmouseup="isKeyPressed(event)" ondblclick="clearSelection()">
 
The 3 pure pipe is only called when Angular detects a change in the value or the parameters passed to a pipe. An impure pipe is called for every change detection cycle no matter whether the value or parameters changes.
 
</p>
<button onclick= "doneSelection()">Done</button>
<script>
var selectArray = [];
var selectObjArray = [];
function isKeyPressed(event) {


    if (window.getSelection) {  
// console.log("Entered getselection if");
                var range = window.getSelection ().getRangeAt(0); 
// console.log(range);
                 
             
            var newNode = document.createElement('span');
newNode.className = 'mark';
           // range.surroundContents(newNode);
   
   
      newNode.appendChild(range.extractContents());
              range.insertNode(newNode);
  selText=range.toString();
//  console.log(range.parentNode);
  
var start = 0, end = 0;
var priorRange, txtLength;
var rangeSelect = {};
// See where the selection is and attach popper to it
//var selection = window.getSelection().getRangeAt(0);
priorRange = range.cloneRange();
var mainDiv = document.getElementById("content");
priorRange.selectNodeContents(mainDiv);
priorRange.setEnd(range.startContainer, range.startOffset);
this.startPoint = priorRange.toString().length;
this.txtLength = range.toString().length;
this.endPoint = this.startPoint + range.toString().length;
// console.log("startPoint: "+this.startPoint + ' ' +"endPoint: "+ this.endPoint + " txtLenght: "+ this.txtLength);

rangeSelect.selectedText = range.toString();
rangeSelect.startPoint = this.startPoint;
rangeSelect.txtLength = this.txtLength;
  
  
  if (newNode.innerText != "") { 
//  console.log("Entered innerText notblank if"); 
  selectArray.push(newNode.innerText); 
  selectObjArray.push(rangeSelect);
  }
            // console.log(selectArray);  
// console.log(selectObjArray);
  
/* 
if (event.altKey) 
{
         //mark the selected element when alt is pressed 
console.log("Entered event if");
 
           if (window.getSelection) {  
console.log("Entered getselection if");
                var range = window.getSelection ().getRangeAt(0); 
console.log(range);
                 
             
            var newNode = document.createElement('span');
newNode.className = 'mark';
           // range.surroundContents(newNode);
   
   
      newNode.appendChild(range.extractContents());
              range.insertNode(newNode);
            
            if (newNode.innerText != "") { console.log("Entered innerText notblank if"); selectArray.push(newNode.innerText);}
             console.log(selectArray);   
                
            } 
            else {
console.log("Entered getselcetion else");
               if (document.selection.createRange) { // Internet Explorer
                  var range = document.selection.createRange ();
                  alert (range.text);
  console.log(range.text);
              }
           }
        } */

}
     else{
console.log("Entered event else");
        /*unmark the selected elements when ctrl is not pressed*/ 
        var element = document.getElementsByClassName("mark"), index;
   
/*alert(element);
alert(element[index]);
alert(element[index]).parentNode; */
        for (index = element.length - 1; index >= 0; index--) {
    //if (element[index].innerText != "") {selectArray.push(element[index].innerText);}
            element[index].parentNode.insertBefore(document.createTextNode(element[index].textContent), element[index]);
            element[index].parentNode.removeChild(element[index]);
  }
console.log(selectArray);
    }
}


function doneSelection() {
var element = document.getElementsByClassName("mark"), index;
   
/*alert(element);
alert(element[index]);
alert(element[index]).parentNode; */
        for (index = element.length - 1; index >= 0; index--) {
    //if (element[index].innerText != "") {selectArray.push(element[index].innerText);}
            element[index].parentNode.insertBefore(document.createTextNode(element[index].textContent), element[index]);
            element[index].parentNode.removeChild(element[index]);
  }
console.log(selectArray);  
console.log(selectObjArray);
selectArray=[];
selectObjArray={};

    }
	
function clearSelection(){

var element = document.getElementsByClassName("mark"), index;
        for (index = element.length - 1; index >= 0; index--) {
            element[index].parentNode.insertBefore(document.createTextNode(element[index].textContent), element[index]);
            element[index].parentNode.removeChild(element[index]);
  }
selectArray=[];
selectObjArray={};


}	
	


</script>
 
</body>
